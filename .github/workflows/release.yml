name: Release

on:
    push:
        tags:
            - "v*.*.*" # triggers only on version tags

jobs:
    release:
        name: Release Validation & Draft
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Setup PHP
              uses: shivammathur/setup-php@v2
              with:
                  php-version: 8.3
                  tools: composer
                  coverage: none

            - name: Validate composer.json
              run: composer validate --strict

            - name: Ensure package installs without dev dependencies
              run: composer install --no-interaction --prefer-dist --no-dev

            - name: Generate Release Notes (Draft)
              uses: release-drafter/release-drafter@v6
              with:
                  config-name: release-drafter.yml

            - name: Show Draft Release Notes
              run: cat .github/release-drafter-draft.md || echo "No release notes generated"
